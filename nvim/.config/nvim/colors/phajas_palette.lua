-- Generated by colors/build.py from colors/palette.toml
-- License: GPL v3 (palette derives from Modus; see colors/LICENSE)
-- Neovim colorscheme entry point (loaded via :colorscheme phajas_palette)
local palette = {
  ["default_variant"] = "modus_operandi",
  ["variants"] = {
    ["modus_operandi"] = {
      ["flavor"] = "light",
      ["foreground"] = "#000000",
      ["background"] = "#ffffff",
      ["cursor"] = "#000000",
      ["selection_background"] = "#dfa0f0",
      ["selection_foreground"] = "#000000",
      ["ansi"] = {
        "#ffffff",
        "#a60000",
        "#006800",
        "#6f5500",
        "#0031a9",
        "#721045",
        "#005e8b",
        "#000000",
        "#e0e0e0",
        "#d00000",
        "#008900",
        "#808000",
        "#0000ff",
        "#dd22dd",
        "#008899",
        "#595959",
      },
      ["extended"] = {
        ["none"] = "NONE",
        ["bg_main"] = "#ffffff",
        ["bg_dim"] = "#f2f2f2",
        ["bg_alt"] = "#f0f0f0",
        ["fg_main"] = "#000000",
        ["fg_dim"] = "#595959",
        ["fg_alt"] = "#193668",
        ["border"] = "#9f9f9f",
        ["border_highlight"] = "#3b3b3b",
        ["red"] = "#a60000",
        ["red_warmer"] = "#972500",
        ["red_cooler"] = "#a0132f",
        ["red_faint"] = "#7f0000",
        ["green"] = "#006800",
        ["green_warmer"] = "#316500",
        ["green_cooler"] = "#00663f",
        ["green_faint"] = "#2a5045",
        ["yellow"] = "#6f5500",
        ["yellow_warmer"] = "#884900",
        ["yellow_cooler"] = "#7a4f2f",
        ["yellow_faint"] = "#624416",
        ["blue"] = "#0031a9",
        ["blue_warmer"] = "#3548cf",
        ["blue_cooler"] = "#0000b0",
        ["blue_faint"] = "#003497",
        ["magenta"] = "#721045",
        ["magenta_warmer"] = "#8f0075",
        ["magenta_cooler"] = "#531ab6",
        ["magenta_faint"] = "#7c318f",
        ["cyan"] = "#005e8b",
        ["cyan_warmer"] = "#3f578f",
        ["cyan_cooler"] = "#005f5f",
        ["cyan_faint"] = "#005077",
        ["rust"] = "#8a290f",
        ["gold"] = "#80601f",
        ["olive"] = "#56692d",
        ["slate"] = "#2f3f83",
        ["indigo"] = "#4a3a8a",
        ["maroon"] = "#731c52",
        ["pink"] = "#7b435c",
        ["red_intense"] = "#d00000",
        ["green_intense"] = "#008900",
        ["yellow_intense"] = "#808000",
        ["blue_intense"] = "#0000ff",
        ["magenta_intense"] = "#dd22dd",
        ["cyan_intense"] = "#008899",
        ["bg_red_intense"] = "#ff8f88",
        ["bg_green_intense"] = "#8adf80",
        ["bg_yellow_intense"] = "#f3d000",
        ["bg_blue_intense"] = "#bfc9ff",
        ["bg_magenta_intense"] = "#dfa0f0",
        ["bg_cyan_intense"] = "#a4d5f9",
        ["bg_red_subtle"] = "#ffcfbf",
        ["bg_green_subtle"] = "#b3fabf",
        ["bg_yellow_subtle"] = "#fff576",
        ["bg_blue_subtle"] = "#ccdfff",
        ["bg_magenta_subtle"] = "#ffddff",
        ["bg_cyan_subtle"] = "#bfefff",
        ["bg_red_nuanced"] = "#fff1f0",
        ["bg_green_nuanced"] = "#ecf7ed",
        ["bg_yellow_nuanced"] = "#fff3da",
        ["bg_blue_nuanced"] = "#f3f3ff",
        ["bg_magenta_nuanced"] = "#fdf0ff",
        ["bg_cyan_nuanced"] = "#ebf6fa",
        ["bg_completion"] = "#c0deff",
        ["bg_hl_line"] = "#dae5ec",
        ["bg_paren_match"] = "#5fcfff",
        ["bg_paren_expression"] = "#efd3f5",
        ["bg_char_0"] = "#7feaff",
        ["bg_char_1"] = "#ffaaff",
        ["bg_char_2"] = "#dff000",
        ["bg_active"] = "#e0e0e0",
        ["fg_active"] = "#0a0a0a",
        ["bg_inactive"] = "#e9e9e9",
        ["fg_inactive"] = "#404148",
        ["bg_status_line_active"] = "#c8c8c8",
        ["fg_status_line_active"] = "#0a0a0a",
        ["bg_status_line_inactive"] = "#e6e6e6",
        ["fg_status_line_inactive"] = "#585858",
        ["bg_tab_bar"] = "#dfdfdf",
        ["bg_tab_current"] = "#ffffff",
        ["bg_tab_other"] = "#c2c2c2",
        ["fg_tab_other"] = "#333333",
        ["bg_tab_alternate"] = "#c2c2e8",
        ["bg_added"] = "#c1f2d1",
        ["bg_added_faint"] = "#d8f8e1",
        ["bg_added_refine"] = "#aee5be",
        ["bg_added_fringe"] = "#6cc06c",
        ["fg_added"] = "#005000",
        ["fg_added_intense"] = "#006700",
        ["bg_changed"] = "#ffdfa9",
        ["bg_changed_faint"] = "#ffefbf",
        ["bg_changed_refine"] = "#fac090",
        ["bg_changed_fringe"] = "#d7c20a",
        ["fg_changed"] = "#553d00",
        ["fg_changed_intense"] = "#655000",
        ["bg_removed"] = "#ffd8d5",
        ["bg_removed_faint"] = "#ffe9e9",
        ["bg_removed_refine"] = "#f3b5af",
        ["bg_removed_fringe"] = "#d84a4f",
        ["fg_removed"] = "#8f1313",
        ["fg_removed_intense"] = "#aa2222",
        ["bg_diff_context"] = "#f3f3f3",
        ["tinted_bg_main"] = "#fbf7f0",
        ["tinted_bg_dim"] = "#efe9dd",
        ["tinted_border"] = "#9f9690",
        ["tinted_border_highlight"] = "#5c3f3d",
        ["tinted_bg_active"] = "#c9b9b0",
        ["tinted_bg_inactive"] = "#dfd5cf",
        ["tinted_red_faint"] = "#7f0000",
        ["tinted_bg_red_nuanced"] = "#ffe8f0",
        ["tinted_bg_green_nuanced"] = "#e0f5e0",
        ["tinted_bg_yellow_nuanced"] = "#f9ead0",
        ["tinted_bg_blue_nuanced"] = "#ebebff",
        ["tinted_bg_magenta_nuanced"] = "#f6e7ff",
        ["tinted_bg_cyan_nuanced"] = "#e1f3fc",
        ["tinted_bg_completion"] = "#f0c1cf",
        ["tinted_bg_hl_line"] = "#f1d5d0",
        ["tinted_bg_paren_match"] = "#7fdfcf",
        ["tinted_bg_status_line_active"] = "#cab9b2",
        ["tinted_bg_status_line_inactive"] = "#dfd9cf",
        ["tinted_bg_tab_bar"] = "#e0d4ce",
        ["tinted_bg_tab_current"] = "#fbf7f0",
        ["tinted_bg_tab_other"] = "#c8b8b2",
        ["tinted_bg_tab_alternate"] = "#c8b8ca",
        ["tinted_bg_added"] = "#c3ebc1",
        ["tinted_bg_added_faint"] = "#dcf8d1",
        ["tinted_bg_added_refine"] = "#acd6a5",
        ["tinted_bg_added_fringe"] = "#6cc06c",
        ["tinted_bg_changed_fringe"] = "#c0b200",
        ["tinted_bg_removed"] = "#f4d0cf",
        ["tinted_bg_removed_faint"] = "#ffe9e5",
        ["tinted_bg_removed_refine"] = "#f3b5a7",
        ["tinted_bg_removed_fringe"] = "#d84a4f",
        ["tinted_bg_diff_context"] = "#efe9df",
      },
    },
    ["modus_vivendi"] = {
      ["flavor"] = "dark",
      ["foreground"] = "#ffffff",
      ["background"] = "#000000",
      ["cursor"] = "#ffffff",
      ["selection_background"] = "#7030af",
      ["selection_foreground"] = "#ffffff",
      ["ansi"] = {
        "#000000",
        "#ff5f59",
        "#44bc44",
        "#d0bc00",
        "#2fafff",
        "#feacd0",
        "#00d3d0",
        "#ffffff",
        "#303030",
        "#ff5f5f",
        "#44df44",
        "#efef00",
        "#338fff",
        "#ff66ff",
        "#00eff0",
        "#989898",
      },
      ["extended"] = {
        ["none"] = "NONE",
        ["bg_main"] = "#000000",
        ["bg_dim"] = "#1e1e1e",
        ["bg_alt"] = "#0f0f0f",
        ["fg_main"] = "#ffffff",
        ["fg_dim"] = "#989898",
        ["fg_alt"] = "#c6daff",
        ["border"] = "#646464",
        ["border_highlight"] = "#C4C4C4",
        ["red"] = "#ff5f59",
        ["red_warmer"] = "#ff6b55",
        ["red_cooler"] = "#ff7f9f",
        ["red_faint"] = "#ff9580",
        ["green"] = "#44bc44",
        ["green_warmer"] = "#70b900",
        ["green_cooler"] = "#00c06f",
        ["green_faint"] = "#88ca9f",
        ["yellow"] = "#d0bc00",
        ["yellow_warmer"] = "#fec43f",
        ["yellow_cooler"] = "#dfaf7a",
        ["yellow_faint"] = "#d2b580",
        ["blue"] = "#2fafff",
        ["blue_warmer"] = "#79a8ff",
        ["blue_cooler"] = "#00bcff",
        ["blue_faint"] = "#82b0ec",
        ["magenta"] = "#feacd0",
        ["magenta_warmer"] = "#f78fe7",
        ["magenta_cooler"] = "#b6a0ff",
        ["magenta_faint"] = "#caa6df",
        ["cyan"] = "#00d3d0",
        ["cyan_warmer"] = "#4ae2f0",
        ["cyan_cooler"] = "#6ae4b9",
        ["cyan_faint"] = "#9ac8e0",
        ["rust"] = "#db7b5f",
        ["gold"] = "#c0965b",
        ["olive"] = "#9cbd6f",
        ["slate"] = "#76afbf",
        ["indigo"] = "#9099d9",
        ["maroon"] = "#cf7fa7",
        ["pink"] = "#d09dc0",
        ["red_intense"] = "#ff5f5f",
        ["green_intense"] = "#44df44",
        ["yellow_intense"] = "#efef00",
        ["blue_intense"] = "#338fff",
        ["magenta_intense"] = "#ff66ff",
        ["cyan_intense"] = "#00eff0",
        ["bg_red_intense"] = "#9d1f1f",
        ["bg_green_intense"] = "#2f822f",
        ["bg_yellow_intense"] = "#7a6100",
        ["bg_blue_intense"] = "#1640b0",
        ["bg_magenta_intense"] = "#7030af",
        ["bg_cyan_intense"] = "#2266ae",
        ["bg_red_subtle"] = "#620f2a",
        ["bg_green_subtle"] = "#00422a",
        ["bg_yellow_subtle"] = "#4a4000",
        ["bg_blue_subtle"] = "#242679",
        ["bg_magenta_subtle"] = "#552f5f",
        ["bg_cyan_subtle"] = "#004065",
        ["bg_red_nuanced"] = "#2c0614",
        ["bg_green_nuanced"] = "#001904",
        ["bg_yellow_nuanced"] = "#222000",
        ["bg_blue_nuanced"] = "#0f0e39",
        ["bg_magenta_nuanced"] = "#230631",
        ["bg_cyan_nuanced"] = "#041529",
        ["bg_completion"] = "#2f447f",
        ["bg_hl_line"] = "#2f3849",
        ["bg_paren_match"] = "#2f7f9f",
        ["bg_paren_expression"] = "#453040",
        ["bg_char_0"] = "#0050af",
        ["bg_char_1"] = "#7f1f7f",
        ["bg_char_2"] = "#625a00",
        ["bg_active"] = "#303030",
        ["fg_active"] = "#f4f4f4",
        ["bg_inactive"] = "#282828",
        ["fg_inactive"] = "#bfc0c4",
        ["bg_status_line_active"] = "#404040",
        ["fg_status_line_active"] = "#f0f0f0",
        ["bg_status_line_inactive"] = "#2d2d2d",
        ["fg_status_line_inactive"] = "#969696",
        ["bg_tab_bar"] = "#313131",
        ["bg_tab_current"] = "#000000",
        ["bg_tab_other"] = "#545454",
        ["fg_tab_other"] = "#f7f7f7",
        ["bg_tab_alternate"] = "#545490",
        ["bg_added"] = "#00381f",
        ["bg_added_faint"] = "#002910",
        ["bg_added_refine"] = "#034f2f",
        ["bg_added_fringe"] = "#237f3f",
        ["fg_added"] = "#a0e0a0",
        ["fg_added_intense"] = "#80e080",
        ["bg_changed"] = "#363300",
        ["bg_changed_faint"] = "#2a1f00",
        ["bg_changed_refine"] = "#4a4a00",
        ["bg_changed_fringe"] = "#8a7a00",
        ["fg_changed"] = "#efef80",
        ["fg_changed_intense"] = "#c0b05f",
        ["bg_removed"] = "#4f1119",
        ["bg_removed_faint"] = "#380a0f",
        ["bg_removed_refine"] = "#781a1f",
        ["bg_removed_fringe"] = "#b81a1f",
        ["fg_removed"] = "#ffbfbf",
        ["fg_removed_intense"] = "#ff9095",
        ["bg_diff_context"] = "#1a1a1a",
        ["tinted_bg_main"] = "#0d0e1c",
        ["tinted_bg_dim"] = "#1d2235",
        ["tinted_border"] = "#61647a",
        ["tinted_border_highlight"] = "#b290b0",
        ["tinted_bg_active"] = "#4a4f69",
        ["tinted_bg_inactive"] = "#2b3045",
        ["tinted_red_faint"] = "#ff9f80",
        ["tinted_bg_red_nuanced"] = "#350f14",
        ["tinted_bg_green_nuanced"] = "#002718",
        ["tinted_bg_yellow_nuanced"] = "#2c1f00",
        ["tinted_bg_blue_nuanced"] = "#131c4d",
        ["tinted_bg_magenta_nuanced"] = "#2f133f",
        ["tinted_bg_cyan_nuanced"] = "#04253f",
        ["tinted_bg_completion"] = "#483d8a",
        ["tinted_bg_hl_line"] = "#303a6f",
        ["tinted_bg_paren_match"] = "#2f7f9f",
        ["tinted_bg_status_line_active"] = "#393F51",
        ["tinted_bg_status_line_inactive"] = "#292d48",
        ["tinted_bg_tab_bar"] = "#2c3045",
        ["tinted_bg_tab_current"] = "#0d0e1c",
        ["tinted_bg_tab_other"] = "#4a4f6a",
        ["tinted_bg_tab_alternate"] = "#4a4f94",
        ["tinted_bg_added"] = "#003a2f",
        ["tinted_bg_added_faint"] = "#002922",
        ["tinted_bg_added_refine"] = "#035542",
        ["tinted_bg_added_fringe"] = "#23884f",
        ["tinted_bg_changed_fringe"] = "#8f7a30",
        ["tinted_bg_removed"] = "#4f1127",
        ["tinted_bg_removed_faint"] = "#380a19",
        ["tinted_bg_removed_refine"] = "#781a3a",
        ["tinted_bg_removed_fringe"] = "#b81a26",
        ["tinted_bg_diff_context"] = "#1a1f30",
      },
    },
  },
  ["hosts"] = {
  },
}

local function select_variant(flavor)
  for name, variant in pairs(palette.variants or {}) do
    if variant.flavor == flavor then
      return name, variant
    end
  end
  if palette.default_variant and palette.variants and palette.variants[palette.default_variant] then
    return palette.default_variant, palette.variants[palette.default_variant]
  end
  if palette.variants then
    return next(palette.variants)
  end
end

local function apply_terminal(variant)
  if not variant or not variant.ansi then
    return
  end
  for i, color in ipairs(variant.ansi) do
    vim.g["terminal_color_" .. (i - 1)] = color
  end
  vim.g.terminal_color_background = variant.background
  vim.g.terminal_color_foreground = variant.foreground
end

local function set_hl(group, opts)
  vim.api.nvim_set_hl(0, group, opts)
end

local function colors_for(variant)
  local c = {}
  if variant.extended then
    c = vim.deepcopy(variant.extended)
    -- Derived fields to complete the extended palette
    c.bg_sidebar = c.bg_dim
    c.fg_sidebar = c.fg_main
    c.cursor = c.fg_main
    c.comment = c.fg_dim
    c.error = c.red_cooler
    c.warning = c.yellow_cooler
    c.info = c.blue_cooler
    c.hint = c.cyan_faint
    c.ok = c.green_cooler
    c.success = c.fg_added
    c.visual = c.bg_magenta_intense
    c.accent_light = c.blue_faint
    c.accent = c.blue_warmer
    c.accent_darker = c.blue
    c.accent_dark = c.blue_intense
    -- Default (non-tinted/non-accessibility variants) only for now
    return c
  end
  -- Fallback to ANSI-derived minimal palette.
  local a = variant.ansi or {}
  return {
    bg_main = variant.background,
    fg_main = variant.foreground,
    fg_dim = a[9] or a[8],
    fg_alt = a[5] or variant.foreground,
    border = a[8],
    border_highlight = a[9] or a[8],
    red = a[2], green = a[3], yellow = a[4], blue = a[5], magenta = a[6], cyan = a[7],
    bg_dim = a[8],
    bg_alt = variant.background,
    bg_hl_line = a[8],
    bg_paren_match = a[12] or a[5],
    fg_inactive = a[9] or a[8],
    fg_active = a[15] or a[7],
    bg_active = a[8],
    bg_inactive = a[8],
    fg_tab_other = a[9] or a[8],
    bg_tab_other = a[8],
    fg_status_line_active = a[15] or a[7],
    bg_status_line_active = a[1] or variant.background,
    fg_status_line_inactive = a[9] or a[8],
    bg_status_line_inactive = a[1] or variant.background,
    visual = variant.selection_background,
    fg_added = a[3], fg_changed = a[4], fg_removed = a[2],
    bg_added = variant.background, bg_changed = variant.background, bg_removed = variant.background,
    fg_added_intense = a[11] or a[3],
    fg_changed_intense = a[12] or a[4],
    fg_removed_intense = a[10] or a[2],
    bg_added_refine = variant.background,
    bg_changed_refine = variant.background,
    bg_removed_refine = variant.background,
    bg_completion = a[13] or a[5],
    error = a[10] or a[2],
    warning = a[12] or a[4],
    info = a[13] or a[5],
    hint = a[15] or a[7],
    ok = a[11] or a[3],
  }
end

local function apply_highlights(variant)
  local c = colors_for(variant)
  local hls = {
    -- UI
    Normal = { fg = c.fg_main, bg = c.bg_main },
    NormalFloat = { fg = c.fg_active or c.fg_main, bg = c.bg_active or c.bg_main },
    FloatBorder = { fg = c.border_highlight or c.border, bg = c.bg_main },
    FloatTitle = { fg = c.border_highlight or c.border, bg = c.bg_main },
    Folded = { fg = c.green_faint or c.green or c.fg_dim, bg = c.bg_dim or c.bg_main },
    LineNr = { fg = c.fg_main, bg = c.bg_dim or c.bg_main },
    LineNrAbove = { fg = c.fg_dim, bg = c.bg_dim or c.bg_main },
    LineNrBelow = { fg = c.fg_dim, bg = c.bg_dim or c.bg_main },
    CursorLineNr = { fg = c.fg_active or c.fg_main, bg = c.bg_active or c.bg_dim, bold = true },
    SignColumn = { fg = c.fg_dim, bg = c.bg_dim or c.bg_main },
    CursorLine = { bg = c.bg_hl_line or c.bg_dim },
    CursorColumn = { bg = c.bg_hl_line or c.bg_dim },
    NonText = { fg = c.fg_dim },
    ColorColumn = { bg = c.bg_dim or c.bg_main },
    FoldColumn = { fg = c.fg_inactive or c.fg_dim, bg = c.bg_inactive or c.bg_dim or c.bg_main },
    Search = { fg = c.fg_main, bg = c.bg_green_intense or c.bg_completion or c.green },
    IncSearch = { fg = c.fg_main, bg = c.bg_yellow_intense or c.yellow },
    CurSearch = { link = "IncSearch" },
    Substitute = { fg = c.fg_main, bg = c.bg_red_intense or c.red },
    QuickFixLine = { fg = c.fg_main, bg = c.visual or c.bg_hl_line },
    Pmenu = { fg = c.fg_active or c.fg_main, bg = c.bg_active or c.bg_main },
    PmenuSel = { fg = c.bg_active or c.bg_main, bg = c.fg_active or c.fg_main },
    PmenuSbar = { fg = c.fg_active or c.fg_main, bg = c.bg_dim or c.bg_main },
    PmenuThumb = { fg = c.bg_main, bg = c.cursor or c.fg_main },
    Directory = { fg = c.blue },
    Title = { fg = c.fg_alt or c.blue, bold = true },
    Visual = { fg = c.fg_main, bg = c.visual or c.bg_hl_line },
    VisualNOS = { link = "Visual" },
    WildMenu = { fg = c.fg_main, bg = c.visual or c.bg_hl_line },
    Whitespace = { fg = c.fg_dim },
    StatusLine = { fg = c.fg_status_line_active or c.fg_main, bg = c.bg_status_line_active or c.bg_main },
    StatusLineNC = { fg = c.fg_status_line_inactive or c.fg_dim, bg = c.bg_status_line_inactive or c.bg_main },
    TabLine = { fg = c.fg_tab_other or c.fg_dim, bg = c.bg_tab_other or c.bg_dim },
    TabLineSel = { fg = c.fg_main, bg = c.bg_tab_current or c.bg_main, bold = true },
    TabLineFill = { fg = c.fg_dim, bg = c.bg_tab_bar or c.bg_dim },
    WinBar = { link = "TabLineSel" },
    WinBarNC = { link = "TabLine" },
    EndOfBuffer = { fg = c.fg_inactive or c.fg_dim },
    MatchParen = { fg = c.fg_main, bg = c.bg_paren_match or c.bg_completion },
    ModeMsg = { fg = c.fg_dim, bold = true },
    MsgArea = { fg = c.fg_main },
    MoreMsg = { fg = c.blue },
    VertSplit = { fg = c.border },
    WinSeparator = { fg = c.border, bold = true },
    DiffAdd = { fg = c.fg_added, bg = c.bg_added },
    DiffDelete = { fg = c.fg_removed, bg = c.bg_removed },
    DiffChange = { fg = c.fg_changed, bg = c.bg_changed },
    DiffText = { fg = c.fg_changed, bg = c.bg_changed },
    SpecialKey = { fg = c.fg_dim },
    SpellBad = { sp = c.error, undercurl = true },
    SpellCap = { sp = c.warning, undercurl = true },
    SpellLocal = { sp = c.info, undercurl = true },
    SpellRare = { sp = c.hint, undercurl = true },
    WarningMsg = { fg = c.warning },
    Question = { fg = c.blue },

    -- Syntax
    Comment = { fg = c.comment or c.fg_dim, italic = true },
    String = { fg = c.blue_warmer or c.green },
    Character = { fg = c.blue_warmer or c.green },
    Boolean = { fg = c.blue or c.magenta, bold = true },
    Statement = { fg = c.magenta_cooler or c.magenta },
    Conditional = { fg = c.magenta_cooler or c.magenta },
    Repeat = { fg = c.magenta_cooler or c.magenta },
    Label = { fg = c.cyan },
    Keyword = { fg = c.magenta_cooler or c.magenta },
    Exception = { fg = c.magenta_cooler or c.magenta },
    StorageClass = { fg = c.magenta_cooler or c.magenta },
    Structure = { fg = c.magenta_cooler or c.magenta },
    Constant = { fg = c.fg_main },
    Function = { fg = c.magenta },
    Identifier = { fg = c.cyan },
    PreProc = { fg = c.red_cooler or c.red },
    Include = { fg = c.red_cooler or c.red },
    Define = { fg = c.red_cooler or c.red },
    Macro = { fg = c.red_cooler or c.red },
    PreCondit = { fg = c.red_cooler or c.red },
    Todo = { fg = c.magenta, bold = true },
    Type = { fg = c.cyan_cooler or c.cyan },
    TypeDef = { fg = c.cyan_warmer or c.cyan },
    Number = { fg = c.blue_faint or c.magenta },
    Float = { link = "Number" },
    Operator = { fg = c.fg_main },
    Tag = { fg = c.magenta },
    Delimiter = { fg = c.fg_main },
    Special = { link = "Type" },
    SpecialChar = { fg = c.cyan_faint or c.cyan },
    Underlined = { fg = c.fg_alt or c.blue, underline = true },
    Error = { fg = c.fg_main, bg = c.bg_red_intense or c.red },

    -- Diagnostics
    DiagnosticError = { fg = c.error or c.red_intense, bold = true },
    DiagnosticWarn = { fg = c.warning or c.yellow_intense, bold = true },
    DiagnosticInfo = { fg = c.info or c.blue_intense, bold = true },
    DiagnosticHint = { fg = c.hint or c.cyan_intense, bold = true },
    DiagnosticOk = { fg = c.ok or c.green_intense, bold = true },
    DiagnosticUnnecessary = { fg = c.fg_dim },
    DiagnosticVirtualTextError = { fg = c.error or c.red_intense, bold = true },
    DiagnosticVirtualTextWarn = { fg = c.warning or c.yellow_intense, bold = true },
    DiagnosticVirtualTextInfo = { fg = c.info or c.blue_intense, bold = true },
    DiagnosticVirtualTextHint = { fg = c.hint or c.cyan_intense, bold = true },
    DiagnosticVirtualTextOk = { fg = c.ok or c.green_intense, bold = true },
    DiagnosticUnderlineError = { undercurl = true, sp = c.error or c.red_intense },
    DiagnosticUnderlineWarn = { undercurl = true, sp = c.warning or c.yellow_intense },
    DiagnosticUnderlineInfo = { undercurl = true, sp = c.info or c.blue_intense },
    DiagnosticUnderlineHint = { undercurl = true, sp = c.hint or c.cyan_intense },
    DiagnosticUnderlineOk = { undercurl = true, sp = c.ok or c.green_intense },

    -- Diff/Git
    GitSignsAdd = { fg = c.fg_added_intense or c.fg_added, bg = c.bg_added or c.bg_main },
    GitSignsChange = { fg = c.fg_changed_intense or c.fg_changed, bg = c.bg_changed or c.bg_main },
    GitSignsDelete = { fg = c.fg_removed_intense or c.fg_removed, bg = c.bg_removed or c.bg_main },

    -- LSP
    LspReferenceText = { bg = c.bg_blue_intense or c.bg_hl_line, fg = c.fg_main },
    LspReferenceRead = { bg = c.bg_blue_intense or c.bg_hl_line, fg = c.fg_main },
    LspReferenceWrite = { bg = c.bg_blue_intense or c.bg_hl_line, fg = c.fg_main },

    -- Telescope (basic alignment with palette intent)
    TelescopeNormal = { link = 'Normal' },
    TelescopeBorder = { fg = c.border or c.fg_dim, bg = c.bg_main },
    TelescopeTitle = { fg = c.fg_dim, bg = c.bg_main },
    TelescopeSelection = { link = 'CursorLine' },
    TelescopePromptBorder = { fg = c.border_highlight or c.border, bg = c.bg_main },
    TelescopePromptTitle = { fg = c.border_highlight or c.border, bg = c.bg_main },
    TelescopeResultsComment = { fg = c.fg_dim },
    TelescopePromptNormal = { link = 'Normal' },
    TelescopePromptPrefix = { fg = c.accent_darker or c.blue, bg = c.bg_main },
    TelescopeMatching = { fg = c.accent_dark or c.blue_intense, bold = true },

    -- Treesitter (core captures)
    ['@comment'] = { link = 'Comment' },
    ['@error'] = { link = 'Error' },
    ['@punctuation'] = { fg = c.fg_dim },
    ['@punctuation.delimiter'] = { link = 'Delimiter' },
    ['@punctuation.bracket'] = { fg = c.fg_main },
    ['@punctuation.special'] = { fg = c.fg_main },
    ['@string'] = { link = 'String' },
    ['@character'] = { link = 'Character' },
    ['@number'] = { link = 'Number' },
    ['@boolean'] = { link = 'Boolean' },
    ['@float'] = { link = 'Float' },
    ['@constant'] = { link = 'Constant' },
    ['@constant.builtin'] = { fg = c.magenta },
    ['@constant.macro'] = { fg = c.red_cooler or c.red },
    ['@namespace'] = { fg = c.fg_alt or c.blue },
    ['@symbol'] = { fg = c.magenta },
    ['@variable'] = { fg = c.fg_main },
    ['@variable.builtin'] = { fg = c.magenta_cooler or c.magenta },
    ['@variable.parameter'] = { fg = c.fg_main },
    ['@variable.member'] = { fg = c.cyan },
    ['@property'] = { link = '@field' },
    ['@field'] = { fg = c.fg_main },
    ['@function'] = { link = 'Function' },
    ['@function.builtin'] = { fg = c.blue_warmer or c.blue },
    ['@function.macro'] = { fg = c.red_cooler or c.red },
    ['@method'] = { link = 'Function' },
    ['@constructor'] = { fg = c.blue },
    ['@parameter'] = { fg = c.fg_main },
    ['@keyword'] = { link = 'Keyword' },
    ['@keyword.function'] = { link = 'Keyword' },
    ['@keyword.operator'] = { link = 'Operator' },
    ['@keyword.return'] = { link = 'Keyword' },
    ['@conditional'] = { link = 'Conditional' },
    ['@repeat'] = { link = 'Repeat' },
    ['@debug'] = { fg = c.red_cooler or c.red },
    ['@label'] = { link = 'Label' },
    ['@include'] = { link = 'Include' },
    ['@exception'] = { link = 'Exception' },
    ['@type'] = { link = 'Type' },
    ['@type.builtin'] = { fg = c.cyan_cooler or c.cyan },
    ['@type.definition'] = { link = 'Typedef' },
    ['@storageclass'] = { link = 'StorageClass' },
    ['@attribute'] = { fg = c.blue_warmer or c.blue },
    ['@field.yaml'] = { fg = c.cyan },
    ['@string.regex'] = { fg = c.blue_warmer or c.blue },
    ['@string.escape'] = { fg = c.magenta },
    ['@string.special'] = { fg = c.blue },
    ['@text.title'] = { fg = c.blue, bold = true },
    ['@text.emphasis'] = { italic = true },
    ['@text.strong'] = { bold = true },
    ['@text.uri'] = { fg = c.blue, underline = true },
    ['@text.reference'] = { fg = c.magenta },
    ['@text.literal'] = { fg = c.green },
    ['@text.note'] = { fg = c.blue, bold = true },
    ['@text.warning'] = { fg = c.warning or c.yellow },
    ['@text.danger'] = { fg = c.error or c.red },

    -- Treesitter context
    TreesitterContext = { bg = c.bg_dim or c.bg_main },
    TreesitterContextLineNumber = { fg = c.fg_dim, bg = c.bg_dim or c.bg_main },

    -- NvimTree
    NvimTreeNormal = { fg = c.fg_main, bg = c.bg_alt or c.bg_main },
    NvimTreeNormalNC = { fg = c.fg_main, bg = c.bg_alt or c.bg_main },
    NvimTreeFolderName = { fg = c.blue },
    NvimTreeFolderIcon = { fg = c.blue },
    NvimTreeRootFolder = { fg = c.magenta, bold = true },
    NvimTreeSymlink = { fg = c.cyan },
    NvimTreeExecFile = { fg = c.green },
    NvimTreeSpecialFile = { fg = c.magenta_warmer or c.magenta, bold = true },
    NvimTreeIndentMarker = { fg = c.fg_dim },
    NvimTreeGitNew = { fg = c.fg_added_intense or c.fg_added },
    NvimTreeGitDirty = { fg = c.fg_changed_intense or c.fg_changed },
    NvimTreeGitDeleted = { fg = c.fg_removed_intense or c.fg_removed },
    NvimTreeWinSeparator = { fg = c.border, bg = c.bg_alt or c.bg_main },

    -- DAP / DAP UI
    DapBreakpoint = { fg = c.red },
    DapBreakpointCondition = { fg = c.yellow },
    DapBreakpointRejected = { fg = c.red_intense or c.red },
    DapStopped = { fg = c.green },
    DapLogPoint = { fg = c.cyan },
    DapUIScope = { fg = c.cyan },
    DapUIType = { fg = c.magenta },
    DapUIValue = { fg = c.fg_main },
    DapUIThread = { fg = c.green },
    DapUIStoppedThread = { fg = c.red },
    DapUISource = { fg = c.blue },
    DapUILineNumber = { fg = c.accent or c.blue },
    DapUIFloatBorder = { fg = c.border_highlight or c.border, bg = c.bg_main },
    DapUIWatchesValue = { fg = c.green },
    DapUIWatchesError = { fg = c.red },
    NvimDapVirtualText = { fg = c.fg_dim, italic = true },

    -- Completion (cmp-style groups used by blink.cmp too)
    CmpItemAbbr = { fg = c.fg_main },
    CmpItemAbbrDeprecated = { fg = c.fg_dim, strikethrough = true },
    CmpItemAbbrMatch = { fg = c.accent or c.blue, bold = true },
    CmpItemAbbrMatchFuzzy = { fg = c.accent_dark or c.blue_intense, bold = true },
    CmpItemMenu = { fg = c.fg_dim },
    CmpItemKindText = { fg = c.fg_main },
    CmpItemKindMethod = { fg = c.blue },
    CmpItemKindFunction = { fg = c.blue },
    CmpItemKindConstructor = { fg = c.magenta },
    CmpItemKindField = { fg = c.cyan },
    CmpItemKindVariable = { fg = c.fg_main },
    CmpItemKindClass = { fg = c.cyan },
    CmpItemKindInterface = { fg = c.cyan },
    CmpItemKindModule = { fg = c.fg_alt or c.blue },
    CmpItemKindProperty = { fg = c.cyan },
    CmpItemKindUnit = { fg = c.yellow },
    CmpItemKindValue = { fg = c.fg_main },
    CmpItemKindEnum = { fg = c.yellow },
    CmpItemKindKeyword = { fg = c.magenta },
    CmpItemKindSnippet = { fg = c.green },
    CmpItemKindColor = { fg = c.magenta },
    CmpItemKindFile = { fg = c.fg_main },
    CmpItemKindReference = { fg = c.magenta },
    CmpItemKindFolder = { fg = c.blue },
    CmpItemKindEnumMember = { fg = c.yellow },
    CmpItemKindConstant = { fg = c.fg_main },
    CmpItemKindStruct = { fg = c.cyan },
    CmpItemKindEvent = { fg = c.magenta },
    CmpItemKindOperator = { fg = c.fg_main },
    CmpItemKindTypeParameter = { fg = c.cyan },
  }

  for group, opts in pairs(hls) do
    set_hl(group, opts)
  end
end

local function apply()
  vim.o.termguicolors = true
  local name, variant = select_variant(vim.o.background)
  if not variant then
    return
  end
  apply_terminal(variant)
  apply_highlights(variant)
  vim.g.colors_name = "phajas_palette"
  return name, variant
end

apply()

return {
  palette = palette,
  apply = apply,
  select_variant = select_variant,
}
