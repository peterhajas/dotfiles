#!/bin/bash

BAR_HEIGHT=0
EDGE_PADDING=20
PADDING=20
WIDGET_PADDING=194
# LEFT_PADDING=86 # width of the $WIDGET_PADDING minus the width the dock takes up on the left
LEFT_PADDING=$EDGE_PADDING

WIDGET_PADDING=$(($WIDGET_PADDING + $EDGE_PADDING))

WIDTH=$(yabai -m query --displays | jq ".[0].frame.w")
LAYOUT="float"

# Set geometry
yabai -m config \
    bottom_padding $EDGE_PADDING \
    external_bar main:$BAR_HEIGHT:0 \
    left_padding $EDGE_PADDING \
    right_padding $PADDING \
    top_padding $EDGE_PADDING \
    window_gap $PADDING

# less than 2000 means stack
if awk -v num="$WIDTH" -v comp="2100" 'BEGIN { exit !(num < comp) }'; then
    LAYOUT="stack"
else
    LAYOUT="float"
fi

# back to stack for now
LAYOUT="stack"

# this is basically the only IF statement that matters
# pad for widgets just on the main display's space
yabai -m config --space 1 layout $LAYOUT left_padding $LEFT_PADDING right_padding $WIDGET_PADDING


# don't pad the other displays
for (( i=2; i<=30; i++ ))
do
    yabai -m config --space $i layout "bsp" top_padding 0 bottom_padding 0 left_padding 0 right_padding 0
done

# apply all rules
yabai -m rule --apply

