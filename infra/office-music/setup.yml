---
- name: Setup office-music
  hosts: office-music
  become: yes
  tasks:
  - name: Install shairport-sync and mpv
    ansible.builtin.package:
      name:
        - shairport-sync
        - mpv
        - yt-dlp
      state: latest
  - name: Copy shairport config file
    ansible.builtin.copy:
      src: shairport-sync.conf
      dest: /etc/shairport-sync.conf
  - name: Ensure shairport is running
    ansible.builtin.service:
      name: shairport-sync
      state: started
    become: yes
  - name: Restart shairport
    ansible.builtin.service:
      name: shairport-sync
      state: restarted
  - name: Disable sleep
    ansible.builtin.systemd:
      name: sleep.target
      enabled: false
      masked: true
  - name: Disable suspend
    ansible.builtin.systemd:
      name: suspend.target
      enabled: false
      masked: true
  - name: Disable hibernate
    ansible.builtin.systemd:
      name: hibernate.target
      enabled: false
      masked: true
  - name: Disable hybrid-sleep
    ansible.builtin.systemd:
      name: hybrid-sleep.target
      enabled: false
      masked: true
